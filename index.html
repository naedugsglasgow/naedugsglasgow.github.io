<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Nae Dugs Glasgow</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>
<div id="map"></div>
<script>
// Mapbox setup
mapboxgl.accessToken = 'pk.eyJ1IjoibmFlZHVnc2dsYXNnb3ciLCJhIjoiY21lM2F4ZXJqMDVqcjJpczc4OXlhd2NjaiJ9.x89RmWhqtd4qR_GKMTYccA';
const map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/streets-v12',
  center: [-4.2518, 55.8642], // Glasgow
  zoom: 12
});

// Colour mapping
const venueTypeColors = {
  'Cafe': '#ADD8E6',
  'Pub': '#40E0D0',
  'Bar': '#90EE90',
  'Outdoors': '#FFA07A',
  'Sightseeing': '#FFB6C1',
  'Things to do': '#9370DB',
  'Activity': '#FFC0CB',
  'Venue': '#800080'
};

const policyColors = {
  'Dog-free indoors': '#008000',
  'Assistance dogs only': '#008000',
  'Designated pet-free area': '#FFBF00',
  'Curfew on dogs': '#FFBF00',
  'Dogs on leads': '#FFBF00',
  'Dog-friendly': '#FF0000'
};

// Airtable API details
const AIRTABLE_BASE_ID = 'appJKCKuw6zmTZvYB';
const AIRTABLE_TABLE_NAME = 'Mapbox';
const AIRTABLE_TOKEN = 'pk.eyJ1IjoibmFlZHVnc2dsYXNnb3ciLCJhIjoiY21lM2F4ZXJqMDVqcjJpczc4OXlhd2NjaiJ9.x89RmWhqtd4qR_GKMTYccA';

// Fetch data from Airtable API
async function loadData() {
  const url = `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${encodeURIComponent(AIRTABLE_TABLE_NAME)}?maxRecords=500&view=Grid%20view`;
  const response = await fetch(url, {
    headers: { Authorization: `Bearer ${AIRTABLE_TOKEN}` }
  });
  const data = await response.json();
  plotData(data.records);
}

// Plot points on the map
function plotData(records) {
  records.forEach(record => {
    const fields = record.fields;
    if (!fields.Latitude || !fields.Longitude) return;

    const popupHTML = `
      <h3>${fields.Name || ''}</h3>
      <p><b>Venue Type:</b> <span style="color:${venueTypeColors[fields['Venue Type']] || '#000'}">${fields['Venue Type'] || ''}</span></p>
      <p><b>Address:</b> ${fields.Address || ''}</p>
      <p><b>Policy:</b> ${fields.Policy || ''}</p>
      ${fields.Link ? `<p><a href="${fields.Link}" target="_blank">More info</a></p>` : ''}
    `;

    new mapboxgl.Marker({ color: policyColors[fields.Policy] || '#000' })
      .setLngLat([fields.Longitude, fields.Latitude])
      .setPopup(new mapboxgl.Popup().setHTML(popupHTML))
      .addTo(map);
  });
}

// Run
loadData();

</script>
</body>
</html>
